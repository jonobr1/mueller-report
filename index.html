<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>The Mueller Report</title>
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="scripts">
      <script src="./node_modules/mpe/lib/mpe.js"></script>
      <script src="./third-party/three.js"></script>
      <script src="./third-party/two.js"></script>
      <script src="./src/page-reader.js"></script>
      <script src="./src/controller.js"></script>
      <script>

        var data;

        var two = new Two({
          type: Two.Types.canvas,
          fullscreen: true,
          autostart: true
        }).appendTo(document.body);

        two.renderer.domElement.style.background = 'black';

        var text = two.makeText('', two.width / 2, two.height / 2, {
          fill: 'white',
          weight: 900,
          stroke: 'transparent',
          family: 'Work Sans, sans-serif'
        });

        var controller = new Controller();

        var reader = new PageReader('./assets/mueller-report.json');
        reader.bind('load', setup);

        // window.addEventListener('click', onControllerDown, false);

        function setup() {

          nextPage();

          controller.bind('down', onControllerDown)
            .bind('update', onControllerUpdate)
            .bind('up', onControllerUp);

          two.bind('resize', resize).bind('update', update);

        }

        function resize() {
          text.position.set(two.width / 2, two.height / 2);
        }

        function update() {
          text.opacity -= text.opacity * 0.1;
        }

        function onControllerDown(e) {
          // console.log(arguments);

          var index = data.index;
          text.value = data[index].toUpperCase();
          text.scale = 1;

          var rect = text.getBoundingClientRect(true);
          text.scale = Math.min(two.height / rect.width, 10);
          text.opacity = 1;
          // text.weight = 900 - (100 * Math.floor(8 * e.noteNumber / 24) + 100);

          data.index++;
          if (data.index >= data.length) {
            nextPage();
          }

        }

        function onControllerUpdate(e) {
          // console.log(arguments);
        }

        function onControllerUp(e) {
          // console.log(arguments);
        }

        function nextPage() {
          data = reader.next();
          data.index = 0;
        }

      </script>
    </div>
  </body>
</html>
